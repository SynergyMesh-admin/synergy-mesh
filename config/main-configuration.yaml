# =============================================================================
# SynergyMesh Workflow System - Main Configuration
# =============================================================================
# 主配置檔案 | Master Configuration File
#
# This configuration file defines the complete workflow system architecture,
# including AI governance, validation layers, deployment settings, and
# operational parameters.
#
# 此配置文件定義了完整的工作流程系統架構，包括AI治理、驗證層、部署設置和運營參數。
# =============================================================================

version: "2.0.0"
schema_version: "workflow.synergymesh.io/v1"

# =============================================================================
# System Metadata | 系統元數據
# =============================================================================
metadata:
  name: "SynergyMesh Workflow System"
  description: "Production-ready workflow orchestration with AI governance"
  environment: "production"
  maintainers:
    - "SynergyMesh Core Team"
  created_at: "2025-12-08T23:27:00Z"
  last_updated: "2025-12-08T23:27:00Z"

# =============================================================================
# Core Engine Configuration | 核心引擎配置
# =============================================================================
core_engine:
  # Contract Engine Settings | 契約引擎設置
  contract_engine:
    enabled: true
    version: "2.0.0"
    execution_mode: "strict"  # strict | permissive | audit
    
    # Contract Registry | 契約註冊表
    registry:
      type: "distributed"
      storage_backend: "postgresql"
      cache_enabled: true
      cache_ttl_seconds: 300
      
    # Contract Validation | 契約驗證
    validation:
      pre_execution: true
      post_execution: true
      async_validation: true
      validation_timeout_seconds: 30
      
    # Contract Lifecycle | 契約生命週期
    lifecycle:
      auto_upgrade: false
      deprecation_period_days: 90
      rollback_enabled: true
      rollback_max_versions: 5

  # Plugin System | 插件系統
  plugin_system:
    enabled: true
    auto_discovery: true
    plugin_directories:
      - "/app/plugins"
      - "/app/core/plugins"
      - "/app/custom_plugins"
    
    # Plugin Security | 插件安全性
    security:
      sandbox_enabled: true
      signature_verification: true
      allowed_capabilities:
        - "network.http"
        - "storage.read"
        - "storage.write"
        - "compute.execute"
      
    # Plugin Registry | 插件註冊表
    registry:
      type: "local"  # local | remote | hybrid
      remote_url: "https://plugins.synergymesh.io"
      sync_interval_seconds: 3600

# =============================================================================
# AI Governance Configuration | AI 治理配置
# =============================================================================
ai_governance:
  # Analysis Engine | 分析引擎
  analysis_engine:
    enabled: true
    
    # Pattern Recognition | 模式識別
    pattern_recognition:
      algorithms:
        - name: "structural_analyzer"
          type: "ast_based"
          confidence_threshold: 0.85
          enabled: true
        - name: "semantic_analyzer"
          type: "ml_based"
          model: "bert-base-uncased"
          confidence_threshold: 0.80
          enabled: true
        - name: "dependency_analyzer"
          type: "graph_based"
          max_depth: 10
          enabled: true
      
      # Pattern Database | 模式數據庫
      database:
        antipatterns_count: 150
        best_practices_count: 300
        security_patterns_count: 100
        performance_patterns_count: 80
    
    # Conflict Detection | 衝突檢測
    conflict_detection:
      enabled: true
      strategies:
        - name: "semantic_conflict"
          type: "nlp_based"
          threshold: 0.75
        - name: "structural_conflict"
          type: "ast_diff"
          threshold: 0.70
        - name: "dependency_conflict"
          type: "graph_analysis"
          threshold: 0.80
      
      resolution:
        auto_resolve: false
        suggest_resolution: true
        priority_rules:
          - "security_first"
          - "performance_second"
          - "maintainability_third"
    
    # Risk Assessment | 風險評估
    risk_assessment:
      enabled: true
      
      # Risk Matrix | 風險矩陣
      matrix:
        dimensions:
          - impact  # critical | high | medium | low
          - probability  # very_high | high | medium | low | very_low
          - complexity  # very_complex | complex | moderate | simple
        
        thresholds:
          critical:
            impact: "critical"
            probability: "high"
            max_complexity: "complex"
          high:
            impact: "high"
            probability: "medium"
            max_complexity: "very_complex"
          medium:
            impact: "medium"
            probability: "low"
            max_complexity: "moderate"
          low:
            impact: "low"
            probability: "very_low"
            max_complexity: "simple"
      
      # Decision Tree | 決策樹
      decision_tree:
        root: "risk_level_assessment"
        nodes:
          - id: "risk_level_assessment"
            type: "classifier"
            criteria: "combined_risk_score"
          - id: "mitigation_strategy"
            type: "action"
            strategies:
              - "immediate_intervention"
              - "scheduled_review"
              - "monitoring_only"
          - id: "approval_routing"
            type: "router"
            routes:
              critical: "security_team"
              high: "senior_engineer"
              medium: "team_lead"
              low: "automated_approval"

  # Governance Policies | 治理政策
  policies:
    # Code Quality | 代碼質量
    code_quality:
      min_test_coverage: 80
      max_complexity: 15
      max_function_lines: 50
      max_file_lines: 500
      
    # Security | 安全性
    security:
      scan_enabled: true
      block_on_critical: true
      block_on_high: false
      vulnerability_db: "nvd"
      
    # Performance | 性能
    performance:
      max_execution_time_ms: 5000
      max_memory_mb: 512
      max_cpu_percent: 80

# =============================================================================
# Validation System Configuration | 驗證系統配置
# =============================================================================
validation_system:
  # Multi-Layer Validation | 多層驗證
  multi_layer:
    enabled: true
    fail_fast: false
    parallel_execution: true
    max_parallel_validators: 5
    
    # Validation Layers | 驗證層
    layers:
      - name: "syntax"
        order: 1
        enabled: true
        severity: "critical"
        timeout_seconds: 10
        
      - name: "semantic"
        order: 2
        enabled: true
        severity: "high"
        timeout_seconds: 30
        
      - name: "security"
        order: 3
        enabled: true
        severity: "critical"
        timeout_seconds: 60
        
      - name: "performance"
        order: 4
        enabled: true
        severity: "medium"
        timeout_seconds: 45
        
      - name: "compliance"
        order: 5
        enabled: true
        severity: "high"
        timeout_seconds: 20
  
  # Syntax Validation | 語法驗證
  syntax_validation:
    parsers:
      python:
        version: "3.10"
        strict_mode: true
        check_types: true
      typescript:
        version: "5.0"
        strict_mode: true
        check_types: true
      yaml:
        version: "1.2"
        strict_mode: true
        
    linters:
      python:
        - "pylint"
        - "flake8"
        - "mypy"
      typescript:
        - "eslint"
        - "tslint"
      
  # Semantic Validation | 語義驗證
  semantic_validation:
    enabled: true
    
    # Context Analysis | 上下文分析
    context_analysis:
      scope_checking: true
      type_inference: true
      flow_analysis: true
      
    # Consistency Checks | 一致性檢查
    consistency:
      naming_conventions: true
      api_contracts: true
      data_contracts: true
      
  # Security Validation | 安全驗證
  security_validation:
    enabled: true
    
    # Vulnerability Scanning | 漏洞掃描
    vulnerability_scanning:
      enabled: true
      scanners:
        - name: "trivy"
          type: "container"
          enabled: true
        - name: "snyk"
          type: "dependency"
          enabled: true
        - name: "codeql"
          type: "sast"
          enabled: true
      
    # Security Policies | 安全政策
    policies:
      # OWASP Top 10 Checks
      owasp_top_10:
        - "injection"
        - "broken_authentication"
        - "sensitive_data_exposure"
        - "xxe"
        - "broken_access_control"
        - "security_misconfiguration"
        - "xss"
        - "insecure_deserialization"
        - "using_components_with_known_vulnerabilities"
        - "insufficient_logging_monitoring"
      
      # Custom Security Rules | 自定義安全規則
      custom_rules:
        - name: "no_hardcoded_secrets"
          severity: "critical"
          pattern: "(password|api_key|secret)\\s*=\\s*['\"]\\w+"
        - name: "no_sql_injection"
          severity: "critical"
          pattern: "execute\\(.*\\+.*\\)"

# =============================================================================
# Pipeline Configuration | 流程配置
# =============================================================================
pipeline:
  # Execution Settings | 執行設置
  execution:
    mode: "orchestrated"  # orchestrated | distributed | serverless
    concurrency: 10
    timeout_seconds: 3600
    retry_policy:
      enabled: true
      max_retries: 3
      backoff_strategy: "exponential"
      initial_delay_seconds: 5
    
  # Stages | 階段
  stages:
    # Stage 1: Analysis | 分析
    - name: "analysis"
      order: 1
      enabled: true
      timeout_seconds: 300
      
      tasks:
        - name: "code_analysis"
          type: "ai_powered"
          parallel: true
          subtasks:
            - "structural_analysis"
            - "semantic_analysis"
            - "dependency_analysis"
            - "pattern_recognition"
            - "conflict_detection"
            - "risk_assessment"
        
        - name: "requirement_extraction"
          type: "nlp_based"
          parallel: false
          
        - name: "impact_analysis"
          type: "graph_based"
          parallel: false
    
    # Stage 2: Validation | 驗證
    - name: "validation"
      order: 2
      enabled: true
      timeout_seconds: 600
      
      tasks:
        - name: "syntax_validation"
          type: "parser_based"
          parallel: true
          
        - name: "semantic_validation"
          type: "ai_assisted"
          parallel: true
          
        - name: "security_validation"
          type: "scanner_based"
          parallel: true
          
        - name: "performance_validation"
          type: "benchmark_based"
          parallel: false
          
        - name: "compliance_validation"
          type: "policy_based"
          parallel: false
    
    # Stage 3: Deployment | 部署
    - name: "deployment"
      order: 3
      enabled: true
      timeout_seconds: 900
      
      tasks:
        - name: "build"
          type: "containerized"
          parallel: false
          
        - name: "test"
          type: "automated"
          parallel: true
          subtasks:
            - "unit_tests"
            - "integration_tests"
            - "e2e_tests"
          
        - name: "deploy"
          type: "blue_green"
          parallel: false
          
        - name: "verify"
          type: "smoke_test"
          parallel: false
          
        - name: "monitor"
          type: "observability"
          parallel: false

  # Quality Gates | 質量門檻
  quality_gates:
    - name: "code_quality"
      stage: "validation"
      criteria:
        test_coverage: ">= 80%"
        complexity: "<= 15"
        duplication: "<= 3%"
      blocking: true
      
    - name: "security"
      stage: "validation"
      criteria:
        critical_vulnerabilities: "== 0"
        high_vulnerabilities: "<= 2"
      blocking: true
      
    - name: "performance"
      stage: "deployment"
      criteria:
        response_time_p95: "<= 200ms"
        error_rate: "<= 0.1%"
      blocking: false

# =============================================================================
# Deployment Configuration | 部署配置
# =============================================================================
deployment:
  # Strategy | 策略
  strategy:
    type: "blue_green"  # blue_green | canary | rolling | recreate
    
    # Blue-Green Settings | 藍綠部署設置
    blue_green:
      enabled: true
      switch_mode: "automated"  # automated | manual
      verification_period_seconds: 300
      rollback_on_failure: true
      
    # Canary Settings | 金絲雀部署設置
    canary:
      enabled: false
      stages:
        - percentage: 10
          duration_seconds: 600
        - percentage: 50
          duration_seconds: 1800
        - percentage: 100
          duration_seconds: 0
  
  # Environment Configuration | 環境配置
  environments:
    - name: "development"
      enabled: true
      replicas: 1
      resources:
        cpu: "500m"
        memory: "512Mi"
      
    - name: "staging"
      enabled: true
      replicas: 2
      resources:
        cpu: "1000m"
        memory: "1Gi"
      
    - name: "production"
      enabled: true
      replicas: 5
      resources:
        cpu: "2000m"
        memory: "2Gi"
  
  # Health Checks | 健康檢查
  health_checks:
    liveness:
      enabled: true
      path: "/health/live"
      interval_seconds: 30
      timeout_seconds: 5
      failure_threshold: 3
      
    readiness:
      enabled: true
      path: "/health/ready"
      interval_seconds: 10
      timeout_seconds: 3
      failure_threshold: 3
  
  # Monitoring | 監控
  monitoring:
    enabled: true
    
    # Metrics | 指標
    metrics:
      - name: "request_rate"
        type: "counter"
        unit: "requests/second"
      - name: "error_rate"
        type: "gauge"
        unit: "percentage"
      - name: "response_time"
        type: "histogram"
        unit: "milliseconds"
        
    # Alerts | 警報
    alerts:
      - name: "high_error_rate"
        condition: "error_rate > 1%"
        severity: "critical"
        channels: ["pagerduty", "slack"]
      - name: "slow_response"
        condition: "response_time_p95 > 500ms"
        severity: "warning"
        channels: ["slack"]

# =============================================================================
# Observability Configuration | 可觀察性配置
# =============================================================================
observability:
  # Logging | 日誌
  logging:
    enabled: true
    level: "info"  # debug | info | warning | error | critical
    format: "json"
    
    # Structured Logging | 結構化日誌
    structured:
      enabled: true
      fields:
        - "timestamp"
        - "level"
        - "message"
        - "service"
        - "trace_id"
        - "span_id"
    
    # Log Aggregation | 日誌聚合
    aggregation:
      enabled: true
      backend: "elasticsearch"
      retention_days: 30
  
  # Tracing | 追蹤
  tracing:
    enabled: true
    sampler: "probabilistic"
    sampling_rate: 0.1
    backend: "jaeger"
    
  # Metrics | 指標
  metrics:
    enabled: true
    backend: "prometheus"
    scrape_interval_seconds: 15
    retention_days: 15

# =============================================================================
# Security Configuration | 安全配置
# =============================================================================
security:
  # Authentication | 認證
  authentication:
    enabled: true
    provider: "oauth2"
    token_expiry_seconds: 3600
    
  # Authorization | 授權
  authorization:
    enabled: true
    model: "rbac"  # rbac | abac
    
    # RBAC Roles | RBAC 角色
    rbac:
      roles:
        - name: "admin"
          permissions: ["*"]
        - name: "developer"
          permissions:
            - "deploy:dev"
            - "deploy:staging"
            - "view:*"
        - name: "viewer"
          permissions:
            - "view:*"
  
  # Encryption | 加密
  encryption:
    enabled: true
    algorithm: "AES-256-GCM"
    key_rotation_days: 90
    
  # Network Security | 網絡安全
  network:
    tls_enabled: true
    tls_version: "1.3"
    mtls_enabled: true
    
  # Secrets Management | 密鑰管理
  secrets:
    backend: "vault"  # vault | aws_secrets_manager | azure_keyvault
    rotation_enabled: true
    rotation_interval_days: 30

# =============================================================================
# Self-Improvement Configuration | 自我改進配置
# =============================================================================
self_improvement:
  enabled: true
  
  # Learning System | 學習系統
  learning:
    enabled: true
    
    # Pattern Learning | 模式學習
    pattern_learning:
      enabled: true
      min_samples: 100
      confidence_threshold: 0.90
      update_frequency: "daily"
      
    # Feedback Loop | 反饋循環
    feedback_loop:
      enabled: true
      sources:
        - "deployment_outcomes"
        - "validation_results"
        - "user_feedback"
        - "incident_reports"
      
      # Continuous Improvement | 持續改進
      continuous_improvement:
        enabled: true
        improvement_cycle_days: 7
        metrics:
          - "deployment_success_rate"
          - "validation_accuracy"
          - "false_positive_rate"
          - "time_to_deployment"
  
  # Model Updates | 模型更新
  model_updates:
    enabled: true
    strategy: "shadow_mode"  # shadow_mode | canary | immediate
    validation_period_days: 14
    auto_promotion: false

# =============================================================================
# Integration Configuration | 集成配置
# =============================================================================
integrations:
  # Version Control | 版本控制
  vcs:
    provider: "github"
    webhook_enabled: true
    
  # CI/CD | 持續集成/持續部署
  cicd:
    provider: "github_actions"
    auto_trigger: true
    
  # Issue Tracking | 問題追蹤
  issue_tracking:
    provider: "github_issues"
    auto_create: true
    
  # Communication | 溝通
  communication:
    channels:
      - type: "slack"
        enabled: true
        webhook_url: "${SLACK_WEBHOOK_URL}"
      - type: "email"
        enabled: true
        smtp_host: "${SMTP_HOST}"

# =============================================================================
# Feature Flags | 功能開關
# =============================================================================
feature_flags:
  ai_governance: true
  multi_layer_validation: true
  blue_green_deployment: true
  canary_deployment: false
  self_improvement: true
  advanced_security: true
  distributed_tracing: true
  automated_rollback: true

# =============================================================================
# End of Configuration | 配置結束
# =============================================================================
